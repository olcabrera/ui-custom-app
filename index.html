

<head>
    <title>Onvif Config</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">


    <link href="apps.css" type="text/css" rel="stylesheet">
    <link href="inputs_designe.css" type="text/css" rel="stylesheet">
    <link href="table.css" type="text/css" rel="stylesheet">
    <script src="../base1/cockpit.js"></script>
    <script src="jquery.js" type="text/javascript"></script>
    <script src="files.js" type="text/javascript"></script>
    <script src="mqttws31.min.js"></script>
    <script src="mqtt_client.js"></script>
    <script src="index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  </head>
  <body class="pf-m-redhat-font">
    <div class="ct-page-fill">
       <div class="pf-c-page">
          <main class="pf-c-page__main" tabindex="-1">
             <section class="pf-c-page__main-section pf-m-light">
                <h2>Custom App Selection</h2>
                <!-- <p>Select custom apps to install</p> -->
                <br>
                <hr>
             </section>
             <section>
                <article>
                   <div class="pdp-tabs">
                      <input id="tab-one" type="radio" name="grp" checked="checked" />
                      <label for="tab-one">Select</label>
                      <div class="pdp-tab-content">
                         <h1>Select Custom Apps</h1>
                         <section class="pf-c-page__main-section">
                            <div class="pf-l-gallery pf-m-gutter">
                                <article id="adu-provision" class="pf-c-card">
                                    <div class="pf-l-flex pf-m-align-items-center">
                                        <div class="pf-c-card__body"> 
                                            <div class="pf-l-stack__item">
                                                <div class="header-container">
                                                    <div class="buttons-container">
                                                        <p>Config Files</p>
                                                        <button class="pf-c-button pf-m-primary" id="download-button">Download</button>
                                                        <button class="pf-c-button pf-m-primary" id="upload-button">Upload</button>
                                                        <input type="file" id="uploadInput" accept=".zip" style="display: none;">
                                                    </div>

                                                    <div class="button-refresh-box">
                                                        <button class="pf-c-button pf-m-primary" id="refresh-button" aria-label="Refresh">
                                                            <a class="button-refresh-title">Refresh</a>
                                                                <svg class="icon-refresh" xmlns="http://www.w3.org/2000/svg"
                                                                     fill="none" viewBox="0 0 24 24"
                                                                     stroke-width="1.5" stroke="currentColor">
                                                                  <path stroke-linecap="round" stroke-linejoin="round"
                                                                        d="M19.5 12c0-1.232-.046-2.453-.138-3.662
                                                                           a4.006 4.006 0 0 0-3.7-3.7
                                                                           48.678 48.678 0 0 0-7.324 0
                                                                           a4.006 4.006 0 0 0-3.7 3.7
                                                                           c-.017.22-.032.441-.046.662
                                                              
                                                                           M19.5 12l3-3m-3 3-3-3
                                                              
                                                                           m-12 3c0 1.232.046 2.453.138 3.662
                                                                           a4.006 4.006 0 0 0 3.7 3.7
                                                                           48.656 48.656 0 0 0 7.324 0
                                                                           a4.006 4.006 0 0 0 3.7-3.7
                                                                           c.017-.22.032-.441.046-.662
                                                              
                                                                           M4.5 12l3 3m-3-3-3 3" />
                                                                </svg>
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                

                                                <div class="pf-l-stack">
                                                    <div class="loader-1" id="loader-1">
                                                
                                                    </div>
                                                    <table id="table-apps" class="invisible">
                                                        <thead>
                                                            <th class="cell-status">Status</th>
                                                            <th class="cell-app">Custom App</th>
                                                            <th class="cell-version">Version</th>
                                                        </thead>
                                                        <tbody id="app-lista">
                                                            <!-- <tr>
                                                                <td>
                                                                    <input class="input-s" type="checkbox" id="chk-Onvif-Custom-Application" checked />
                                                                    <label class="label" for="chk-Onvif-Custom-Application"></label>
                                                                </td>
                                                                <td>
                                                                    <h3 class="label-switch">Onvif-Custom-Application</h3>
                                                                </td>  
                                                                <td>
                                                                    <select class="dropdown" id="ddl-Onvif-Custom-Application">
                                                                        <option value="v0.1">v0.1</option>
                                                                        <option value="v0.2" selected>v0.2</option>
                                                                    </select>
                                                                </td>          
                                                            </tr>

                                                            <tr>
                                                                <td>
                                                                    <input class="input-s" type="checkbox" id="chk-Storeops-Custom-Application" checked />
                                                                    <label class="label" for="chk-Storeops-Custom-Application"></label>
                                                                </td>
                                                                <td>
                                                                    <h3 class="label-switch">Storeops-Custom-Application</h3>
                                                                </td>  
                                                                <td>
                                                                    <select class="dropdown" id="ddl-Storeops-Custom-Application">
                                                                        <option value="v1.1">v1.1</option>
                                                                        <option value="v1.2" selected true>v1.2</option>
                                                                    </select>
                                                                </td>          
                                                            </tr> -->
                                                        </tbody>
                                                    </table>
                                                   

                                                </div>
                                                <button class="pf-c-button pf-m-primary invisible-hidden" id="apply-button">Submit</button>
                                            </div>
                                        </div>
                                    </div>
                                </article>
                                <br> 
                            </div>
                        </section>
                      </div>
                      <input id="tab-two" type="radio" name="grp" />
                      <label for="tab-two">Active</label>
                      <div class="pdp-tab-content">
                         <h1>Active</h1>
                         <section class="pf-c-page__main-section">
                           <div class="pf-l-gallery pf-m-gutter">
                               <article id="adu-provision" class="pf-c-card">
                                   <div class="pf-l-flex pf-m-align-items-center">
                                       <div class="pf-c-card__body"> 
                                        <section class="pf-c-page__main-section pf-m-light">
                                            
                                            <div class="config-buttons">
                                                <button class="pf-c-button pf-m-primary" id="list-apps-button">List</button>
                                                <button class="pf-c-button pf-m-secondary" id="clear-apps-button">Clear</button>

                                            </div>
                                            
                                            <div id="app-list-result" class="pf-c-list invisible">
                                                <!-- <p class="app-list-title">Checking Custom Application List....</p><br>
                                                <table class="table-custom-apps">
                                                    <thead><th>App</th><th>Version</th><th>Status</th><th>CPU</th></thead>
                                                    <tbody>
                                                        <tr><td>Onvif-Custom-Application</td><td>v2.0.3-beta.21</td><td>running</td><td>53.2%</td></tr>
                                                        <tr><td>storeops-Custom-Application</td><td>v1.0.5</td><td>running</td><td>2.4%</td></tr>
                                                    </tbody>
                                                </tbody></table> -->

                                                <p class="app-list-title">Checking Custom Application List....</p><br>
                                                <table class="table-custom-apps" id="table-custom-apps">
                                                    <thead>
                                                        <th>App</th>
                                                        <th>Version</th>
                                                        <th>Status</th>
                                                        <th>CPU %</th>
                                                        <th>Memory (MB)</th>
                                                    </thead>
                                                    <tbody id="body-custom-apps">

                                                    </tbody>
                                                </table>
                                                
                                            </div>
                                         </section>
                                       </div>
                                   </div>
                               </article>
                               <br> 
                           </div>
                       </section>
                     </div>



                     <input id="tab-three" type="radio" name="grp" />
                      <label for="tab-three">Downloading</label>
                      <div class="pdp-tab-content">
                         <h1>Downloading</h1>
                         <section class="pf-c-page__main-section">
                           <div class="pf-l-gallery pf-m-gutter">
                               <article id="adu-provision" class="pf-c-card">
                                   <div class="pf-l-flex pf-m-align-items-center">
                                       <div class="pf-c-card__body"> 
                                        <section class="pf-c-page__main-section pf-m-light " id="download-section">
                                            <div class="invisible" id="download-loader">
                                                <h4 class="download-title">Waiting for the download of custom apps</h4>
                                                <div class="loader-1" id="loader-2">
                                                
                                                </div>
                                            </div>

                                            <div class="error-message-ui invisible" id="error-message-ui">
                                                <div class="error-circle">
                                                    <h1>X</h1>
                                                </div>

                                                <h6>Error downloading custom apps</h6>
                                                <pre style="font-size: medium" id="back_end_error"></pre>
                                            </div>
                                            


                                            <table class="table-download-apps invisible" id="table-download-apps">
                                                <thead>
                                                    <th class="cell-app-dw">App</th>
                                                    <th class="cell-version-dw">Version</th>
                                                    <th class="cell-status-dw">Status</th>
                                                </thead>
                                                <tbody id="body-download-apps">

                                                </tbody>
                                            </table>

                                            
                                         </section>
                                       </div>
                                   </div>
                               </article>
                               <br> 
                           </div>
                       </section>
                     </div>


                     
                   </div>
                </article>
             </section>
          </main>
       </div>
    </div>

    

    <script>
        function saveSelection() {
            const items = document.querySelectorAll('.item');
            let data = [];

            items.forEach(item => {
                const toggle = item.querySelector('.toggle');
                const label = item.querySelector('label').innerText;
                const dropdown = item.querySelector('.dropdown');
                
                data.push({
                    name: label,
                    enabled: toggle.checked,
                    version: dropdown.value
                });
            });

            fetch('/save-selection', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => alert('Datos guardados exitosamente!'))
            .catch(error => console.error('Error:', error));
        }
    </script>
  </body>
  </html>
